FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# Copy only requirements first for layer caching
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY ./run_ml.py ./
COPY ./redis_utils.py ./
COPY ./s3_utils.py ./
COPY ./api_types.py ./
COPY ./utils.py ./
COPY ./ml ./ml

# Run the ML processing script
CMD ["python3", "run_ml.py"]
